<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPS IRF Simulator & Resolution Explorer - Mathematical Foundation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #7c3aed;
            --accent: #059669;
            --warning: #d97706;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', 'Hiragino Sans', 'Meiryo', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.8;
            padding: 2rem;
        }
        .container { max-width: 1000px; margin: 0 auto; }

        /* Language Toggle */
        .lang-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--card);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 0.5rem;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .lang-toggle button {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .lang-toggle button.active {
            background: var(--primary);
            color: white;
        }
        .lang-toggle button:hover:not(.active) {
            background: #e2e8f0;
        }

        /* Content sections */
        .ja-content, .en-content { display: none; }
        .ja-content.active, .en-content.active { display: block; }

        h1 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 0.5rem;
        }
        .subtitle {
            color: #64748b;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        .app-link {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            text-decoration: none;
            margin: 1rem 0;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .app-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        h2 {
            font-size: 1.4rem;
            color: var(--secondary);
            margin: 2rem 0 1rem;
            padding-left: 0.8rem;
            border-left: 4px solid var(--secondary);
        }
        h3 {
            font-size: 1.15rem;
            color: var(--accent);
            margin: 1.5rem 0 0.8rem;
        }
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }
        .equation-box {
            background: linear-gradient(135deg, #eff6ff, #f0fdf4);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: center;
            overflow-x: auto;
        }
        .equation-box.final {
            background: linear-gradient(135deg, #fef3c7, #fce7f3);
            border-color: #f59e0b;
        }
        .equation-box.unified {
            background: linear-gradient(135deg, #fdf2f8, #faf5ff);
            border: 3px solid var(--secondary);
            padding: 2rem;
        }
        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        .param-table th, .param-table td {
            padding: 0.5rem 0.8rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .param-table th {
            background: #f1f5f9;
            font-weight: 600;
            color: var(--primary);
        }
        .param-table tr:hover { background: #f8fafc; }
        .code-inline {
            background: #f1f5f9;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85em;
            color: #be185d;
        }
        .note {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        .note.info {
            background: #eff6ff;
            border-left-color: var(--primary);
        }
        .note.success {
            background: #f0fdf4;
            border-left-color: var(--accent);
        }
        .verification {
            background: #f0fdf4;
            border: 1px solid #86efac;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .verification-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.3rem 0;
        }
        .check { color: #22c55e; font-weight: bold; }
        .warn { color: #f59e0b; font-weight: bold; }
        .toc {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        .toc h3 { margin-top: 0; }
        .toc ul { list-style: none; padding-left: 0; }
        .toc li { margin: 0.4rem 0; }
        .toc a { color: var(--primary); text-decoration: none; }
        .toc a:hover { text-decoration: underline; }
        hr { border: none; border-top: 1px solid var(--border); margin: 2rem 0; }
        .flowchart {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
        }
        .flow-arrow {
            font-size: 1.5rem;
            color: var(--primary);
            margin: 0.5rem 0;
        }
        .flow-box {
            display: inline-block;
            background: #eff6ff;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 0.6rem 1.2rem;
            margin: 0.3rem;
            font-size: 0.95rem;
        }
        .novelty-box {
            background: linear-gradient(135deg, #fef3c7, #fce7f3);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        .novelty-box h3 {
            color: var(--warning);
            margin-top: 0;
        }
        footer {
            text-align: center;
            color: #64748b;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }
        footer a { color: var(--primary); }
    </style>
</head>
<body>
    <div class="lang-toggle">
        <button id="btn-ja" class="active" onclick="setLang('ja')">æ—¥æœ¬èª</button>
        <button id="btn-en" onclick="setLang('en')">English</button>
    </div>

    <div class="container">
        <!-- ==================== æ—¥æœ¬èªç‰ˆ ==================== -->
        <div class="ja-content active">
            <h1>ğŸ”¬ XPS IRF Simulator & Resolution Explorer</h1>
            <p class="subtitle">æ•°å­¦çš„åŸºç¤ã¨è£…ç½®é–¢æ•°ã®å³å¯†ãªè¨˜è¿°</p>
            <a href="https://xpstwinapp-fu3hrc35prlzqzncvmfaho.streamlit.app" target="_blank" class="app-link">â–¶ ã‚¢ãƒ—ãƒªã‚’é–‹ã (Streamlit)</a>

            <div class="toc">
                <h3>ç›®æ¬¡</h3>
                <ul>
                    <li><a href="#ja-overview">1. æ¦‚è¦ï¼šãªãœã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒæ–°ã—ã„ã‹</a></li>
                    <li><a href="#ja-flow">2. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æµã‚Œ</a></li>
                    <li><a href="#ja-fermi">3. ãƒ•ã‚§ãƒ«ãƒŸãƒ»ãƒ‡ã‚£ãƒ©ãƒƒã‚¯åˆ†å¸ƒ</a></li>
                    <li><a href="#ja-source">4. Xç·šå…‰æºã®ãƒ¢ãƒ‡ãƒ«åŒ–</a></li>
                    <li><a href="#ja-detector">5. æ¤œå‡ºå™¨ã®ãƒ¢ãƒ‡ãƒ«åŒ–</a></li>
                    <li><a href="#ja-noise">6. ãƒã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«</a></li>
                    <li><a href="#ja-unified">7. çµ±ä¸€çš„ãªæ•°å¼è¡¨ç¾</a></li>
                    <li><a href="#ja-verification">8. å®Ÿè£…ã®æ¤œè¨¼</a></li>
                    <li><a href="#ja-references">9. å‚è€ƒæ–‡çŒ®</a></li>
                </ul>
            </div>

            <!-- Section 1 -->
            <h2 id="ja-overview">1. æ¦‚è¦ï¼šãªãœã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒæ–°ã—ã„ã‹</h2>

            <div class="novelty-box">
                <h3>ğŸ¯ å¾“æ¥æ‰‹æ³•ã¨ã®é•ã„</h3>
                <table class="param-table">
                    <tr><th>å¾“æ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</th><th>æœ¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿</th></tr>
                    <tr><td>è£…ç½®é–¢æ•° = ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ï¼ˆãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰</td><td>å¹¾ä½•å­¦çš„è¦å› ã‚’åˆ†è§£ã—ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–</td></tr>
                    <tr><td>çµæœï¼ˆFWHMï¼‰ã ã‘æ¸¬å®š</td><td>åŸå› ï¼ˆÎº, Î¸, Î±, Ïƒç­‰ï¼‰ã‚’å€‹åˆ¥ã«åˆ¶å¾¡</td></tr>
                    <tr><td>ãƒ¡ãƒ¼ã‚«ãƒ¼ä»»ã›ã®è£œæ­£</td><td>Forward/Inverse ãƒ¢ãƒ‡ãƒ«ã‚’è‡ªåˆ†ã§æ§‹ç¯‰</td></tr>
                    <tr><td>1Dç•³ã¿è¾¼ã¿ã®ã¿</td><td>2Dç©ºé–“ç©åˆ† + åº§æ¨™å¤‰æ›</td></tr>
                </table>
            </div>

            <div class="card">
                <p>XPSè£…ç½®ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆScienta Omicron, SPECSç­‰ï¼‰ã¯å¹¾ä½•å­¦çš„è£œæ­£ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ãŒã€ãã®è©³ç´°ã¯å…¬é–‹ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æœ¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¯ã€ã“ã‚Œã‚‰ã®åŠ¹æœã‚’<strong>ç‰©ç†çš„ã«åˆ†è§£ã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–</strong>ã™ã‚‹ã“ã¨ã§ã€è£…ç½®é–¢æ•°ã®ã€Œä¸­èº«ã€ã‚’ç†è§£å¯èƒ½ã«ã—ã¾ã™ã€‚</p>
            </div>

            <!-- Section 2 -->
            <h2 id="ja-flow">2. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æµã‚Œ</h2>

            <div class="flowchart">
                <div class="flow-box">çœŸã®ç‰©æ€§<br>\(f_{\text{FD}}(E, T)\)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-box">Xç·šå…‰æºã«ã‚ˆã‚‹2Dç™ºå…‰<br>\(I_{\text{source}}(E, y)\)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-box">æ¤œå‡ºå™¨æ­ªã¿ï¼‹åº§æ¨™å¤‰æ›<br>\(\mathcal{D}_{\kappa,\theta}\)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-box">Yè»¸ç©åˆ†ï¼‹åˆ†è§£èƒ½ç•³ã¿è¾¼ã¿</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-box">è¦³æ¸¬ã‚¹ãƒšã‚¯ãƒˆãƒ«<br>\(S_{\text{obs}}(E)\)</div>
            </div>

            <!-- Section 3 -->
            <h2 id="ja-fermi">3. ãƒ•ã‚§ãƒ«ãƒŸãƒ»ãƒ‡ã‚£ãƒ©ãƒƒã‚¯åˆ†å¸ƒ</h2>

            <div class="equation-box">
                \[
                f_{\text{FD}}(E, T) = \frac{1}{1 + \exp\left(\frac{E - E_F}{k_B T}\right)}
                \]
            </div>

            <table class="param-table">
                <tr><th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th><th>èª¬æ˜</th><th>å€¤</th></tr>
                <tr><td>\(k_B\)</td><td>ãƒœãƒ«ãƒ„ãƒãƒ³å®šæ•°</td><td>\(8.617333262 \times 10^{-5}\) eV/K</td></tr>
                <tr><td>\(T\)</td><td>è©¦æ–™æ¸©åº¦</td><td>UI: Temperature (K)</td></tr>
                <tr><td>\(E_F\)</td><td>ãƒ•ã‚§ãƒ«ãƒŸã‚¨ãƒãƒ«ã‚®ãƒ¼</td><td>åŸºæº–ç‚¹ (0 eV)</td></tr>
            </table>

            <!-- Section 4 -->
            <h2 id="ja-source">4. Xç·šå…‰æºã®ãƒ¢ãƒ‡ãƒ«åŒ–</h2>

            <h3>4.1 éå¯¾ç§°ã‚¬ã‚¦ã‚¹åˆ†å¸ƒï¼ˆSkew-Normalï¼‰</h3>

            <div class="equation-box">
                \[
                \phi_\gamma(x; \sigma, \gamma) = 2 \cdot \frac{1}{\sigma\sqrt{2\pi}} \exp\left(-\frac{x^2}{2\sigma^2}\right) \cdot \frac{1}{2}\left[1 + \text{erf}\left(\frac{\gamma x}{\sigma\sqrt{2}}\right)\right]
                \]
            </div>

            <h3>4.2 2Dæ¥•å††ã‚¬ã‚¦ã‚¹åˆ†å¸ƒï¼ˆå›è»¢å¯¾å¿œï¼‰</h3>

            <p><strong>å›è»¢å¤‰æ›ï¼š</strong></p>
            <div class="equation-box">
                \[
                \begin{pmatrix} E' \\ y' \end{pmatrix} =
                \begin{pmatrix} \cos\theta_{\text{rot}} & -\sin\theta_{\text{rot}} \\ \sin\theta_{\text{rot}} & \cos\theta_{\text{rot}} \end{pmatrix}
                \begin{pmatrix} E \\ y \end{pmatrix}
                \]
            </div>

            <h3>4.3 2Dç™ºå…‰åƒã®ç”Ÿæˆ</h3>

            <div class="equation-box">
                \[
                I_{\text{source}}(E, y) = f_{\text{FD}}(E - \alpha y, T) \cdot \phi_{\gamma_y}(y; \sigma_y, \gamma_y)
                \]
            </div>

            <table class="param-table">
                <tr><th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th><th>èª¬æ˜</th><th>UIå</th></tr>
                <tr><td>\(\sigma_x\)</td><td>ã‚¨ãƒãƒ«ã‚®ãƒ¼æ–¹å‘ã‚¹ãƒãƒƒãƒˆã‚µã‚¤ã‚º</td><td>Spot Size X (meV)</td></tr>
                <tr><td>\(\sigma_y\)</td><td>ç©ºé–“æ–¹å‘ã‚¹ãƒãƒƒãƒˆã‚µã‚¤ã‚º</td><td>Spot Size Y (mm)</td></tr>
                <tr><td>\(\gamma_x, \gamma_y\)</td><td>éå¯¾ç§°æ€§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</td><td>Spot Skew X/Y</td></tr>
                <tr><td>\(\theta_{\text{rot}}\)</td><td>ã‚¹ãƒãƒƒãƒˆå›è»¢è§’åº¦</td><td>Spot Rotation (deg)</td></tr>
                <tr><td>\(\alpha\)</td><td>ã‚¨ãƒãƒ«ã‚®ãƒ¼å‹¾é… (dE/dy)</td><td>Energy Gradient</td></tr>
            </table>

            <!-- Section 5 -->
            <h2 id="ja-detector">5. æ¤œå‡ºå™¨ã®ãƒ¢ãƒ‡ãƒ«åŒ–</h2>

            <h3>5.1 å¹¾ä½•å­¦çš„æ­ªã¿</h3>

            <div class="equation-box">
                \[
                E_{\text{src}} = E \cos\theta_{\text{tilt}} + y \sin\theta_{\text{tilt}}
                \]
                \[
                E_{\text{curved}} = E_{\text{src}} - \kappa \left(\frac{y}{y_{\max}}\right)^2
                \]
            </div>

            <div class="note">
                <strong>ã‚¹ãƒã‚¤ãƒ«æ­ªã¿ (Îº):</strong> åŠçƒå‹ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®çƒé¢åå·®ã«ã‚ˆã‚Šã€ç­‰ã‚¨ãƒãƒ«ã‚®ãƒ¼ç·šãŒæ¹¾æ›²ã™ã‚‹åŠ¹æœã€‚Yè»¸ç©åˆ†å¾Œã«é«˜BEå´ã¸ä¼¸ã³ã‚‹éå¯¾ç§°ãªè£¾é‡ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
            </div>

            <h3>5.2 1DæŠ•å½±ã¨åˆ†è§£èƒ½ç•³ã¿è¾¼ã¿</h3>

            <div class="equation-box">
                \[
                S_{\text{obs}}(E) = \left[\int_{-\infty}^{\infty} I_{\text{distorted}}(E, y) \, dy\right] \ast G_{\text{res}}(E; \sigma_{\text{res}})
                \]
            </div>

            <table class="param-table">
                <tr><th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th><th>èª¬æ˜</th><th>UIå</th></tr>
                <tr><td>\(\kappa\)</td><td>ã‚¹ãƒã‚¤ãƒ«æ›²ç‡ä¿‚æ•°</td><td>Smile Curvature</td></tr>
                <tr><td>\(\theta_{\text{tilt}}\)</td><td>æ¤œå‡ºå™¨å‚¾ãè§’åº¦</td><td>Detector Tilt (deg)</td></tr>
                <tr><td>\(\sigma_{\text{res}}\)</td><td>è£…ç½®å›ºæœ‰åˆ†è§£èƒ½</td><td>Intrinsic Res (meV)</td></tr>
            </table>

            <!-- Section 6 -->
            <h2 id="ja-noise">6. ãƒã‚¤ã‚ºãƒ¢ãƒ‡ãƒ«</h2>

            <div class="equation-box">
                \[
                S_{\text{final}}(E) = \frac{\text{Poisson}\left(S_{\text{clean}} \cdot \lambda\right)}{\lambda} + \mathcal{N}(0, \sigma_{\text{readout}})
                \]
            </div>

            <table class="param-table">
                <tr><th>ãƒã‚¤ã‚ºç¨®åˆ¥</th><th>ç‰¹æ€§</th><th>UIå</th></tr>
                <tr><td>ãƒã‚¢ã‚½ãƒ³ãƒã‚¤ã‚º</td><td>ä¿¡å·å¼·åº¦ä¾å­˜ï¼ˆã‚·ãƒ§ãƒƒãƒˆãƒã‚¤ã‚ºï¼‰</td><td>Poisson Noise Level</td></tr>
                <tr><td>ã‚¬ã‚¦ã‚·ã‚¢ãƒ³ãƒã‚¤ã‚º</td><td>ä¿¡å·å¼·åº¦éä¾å­˜ï¼ˆèª­ã¿å‡ºã—ãƒã‚¤ã‚ºï¼‰</td><td>Gaussian Readout Noise</td></tr>
            </table>

            <!-- Section 7 -->
            <h2 id="ja-unified">7. çµ±ä¸€çš„ãªæ•°å¼è¡¨ç¾</h2>

            <div class="equation-box unified">
                <h3 style="color: var(--secondary); margin-bottom: 1rem;">å®Œå…¨ãªè¦³æ¸¬ã‚¹ãƒšã‚¯ãƒˆãƒ«</h3>
                \[
                \boxed{
                S_{\text{obs}}(E) = \left[ \int_{-\infty}^{\infty} f_{\text{FD}}\left(\mathcal{T}(E, y; \kappa, \theta) - \alpha y, T\right) \cdot \phi_{\gamma_y}(y; \sigma_y, \gamma_y) \, dy \right] \ast G_{\text{res}}(E; \sigma_{\text{res}}) + \eta(E)
                }
                \]
            </div>

            <p>ã“ã“ã§åº§æ¨™å¤‰æ›ã¯ï¼š</p>
            <div class="equation-box">
                \[
                \mathcal{T}(E, y; \kappa, \theta) = \left(E \cos\theta + y \sin\theta\right) - \kappa \left(\frac{y}{y_{\max}}\right)^2
                \]
            </div>

            <h3>æ¼”ç®—å­è¡¨è¨˜</h3>
            <div class="equation-box final">
                \[
                S_{\text{obs}} = \mathcal{P}_y \left[ \mathcal{D}_{\kappa,\theta} \left[ \mathcal{S}_\alpha \left[ f_{\text{FD}} \right] \cdot W_y \right] \right] \ast G_{\text{res}} + \eta
                \]
            </div>

            <!-- Section 8 -->
            <h2 id="ja-verification">8. å®Ÿè£…ã®æ¤œè¨¼</h2>

            <div class="verification">
                <h3 style="margin-top: 0;">âœ“ æ¤œè¨¼æ¸ˆã¿é …ç›®</h3>
                <div class="verification-item"><span class="check">âœ“</span> ãƒœãƒ«ãƒ„ãƒãƒ³å®šæ•°: CODATA 2018æº–æ‹ </div>
                <div class="verification-item"><span class="check">âœ“</span> ãƒ•ã‚§ãƒ«ãƒŸãƒ»ãƒ‡ã‚£ãƒ©ãƒƒã‚¯å¼: æ¨™æº–å½¢å¼</div>
                <div class="verification-item"><span class="check">âœ“</span> æ­ªæ­£è¦åˆ†å¸ƒ: ä¿‚æ•°2ã‚’å«ã‚€æ­£ã—ã„å®šç¾©</div>
                <div class="verification-item"><span class="check">âœ“</span> å›è»¢è¡Œåˆ—: åæ™‚è¨ˆå›ã‚Šæ­£ï¼ˆæ¨™æº–ï¼‰</div>
                <div class="verification-item"><span class="check">âœ“</span> ã‚¹ãƒã‚¤ãƒ«æ­ªã¿: yÂ²ä¾å­˜ï¼ˆçƒé¢åå·®ã®ä¸€æ¬¡è¿‘ä¼¼ï¼‰</div>
                <div class="verification-item"><span class="warn">âš </span> 2Dã‚¹ã‚­ãƒ¥ãƒ¼ã‚¬ã‚¦ã‚¹: 1Dç©ã®è¿‘ä¼¼ï¼ˆå®Ÿç”¨ä¸Šååˆ†ï¼‰</div>
            </div>

            <div class="note info">
                <strong>æ–‡çŒ®ã¨ã®æ•´åˆæ€§:</strong> è£…ç½®é–¢æ•°ã‚’Voigté–¢æ•°ï¼ˆã‚¬ã‚¦ã‚·ã‚¢ãƒ³Ã—ãƒ­ãƒ¼ãƒ¬ãƒ³ãƒ„ã‚£ã‚¢ãƒ³ï¼‰ã§æ‰±ã†æ–‡çŒ®ã¯å­˜åœ¨ã—ã¾ã™ãŒã€å¹¾ä½•å­¦çš„è¦å› ã‚’å€‹åˆ¥ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã—ãŸå…¬é–‹æ–‡çŒ®ã¯è¦‹å½“ãŸã‚Šã¾ã›ã‚“ã€‚è£…ç½®ãƒ¡ãƒ¼ã‚«ãƒ¼ã¯è£œæ­£ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ãŒã€è©³ç´°ã¯éå…¬é–‹ã§ã™ã€‚
            </div>

            <!-- Section 9 -->
            <h2 id="ja-references">9. å‚è€ƒæ–‡çŒ®</h2>

            <div class="card">
                <ul style="list-style: disc; padding-left: 1.5rem;">
                    <li>Jain, V. et al., <em>Applied Surface Science</em> 447, 548-553 (2018) - Voigté–¢æ•°ã¨XPS</li>
                    <li>Hemispherical Analyzer - <a href="https://en.wikipedia.org/wiki/Hemispherical_electron_energy_analyzer" target="_blank">Wikipedia</a></li>
                    <li>Scienta Omicron - <a href="https://scientaomicron.com/en/Instruments/Electron-Analysers" target="_blank">Electron Analysers</a></li>
                    <li>SPECS Group - <a href="https://www.specs-group.com/specs/products/" target="_blank">Products</a></li>
                </ul>
            </div>

        </div>

        <!-- ==================== English Version ==================== -->
        <div class="en-content">
            <h1>ğŸ”¬ XPS IRF Simulator & Resolution Explorer</h1>
            <p class="subtitle">Mathematical Foundation and Rigorous Description of Instrumental Response</p>
            <a href="https://xpstwinapp-fu3hrc35prlzqzncvmfaho.streamlit.app" target="_blank" class="app-link">â–¶ Open App (Streamlit)</a>

            <div class="toc">
                <h3>Table of Contents</h3>
                <ul>
                    <li><a href="#en-overview">1. Overview: Why This Approach is Novel</a></li>
                    <li><a href="#en-flow">2. Simulation Pipeline</a></li>
                    <li><a href="#en-fermi">3. Fermi-Dirac Distribution</a></li>
                    <li><a href="#en-source">4. X-ray Source Modeling</a></li>
                    <li><a href="#en-detector">5. Detector Modeling</a></li>
                    <li><a href="#en-noise">6. Noise Model</a></li>
                    <li><a href="#en-unified">7. Unified Mathematical Expression</a></li>
                    <li><a href="#en-verification">8. Implementation Verification</a></li>
                    <li><a href="#en-references">9. References</a></li>
                </ul>
            </div>

            <!-- Section 1 -->
            <h2 id="en-overview">1. Overview: Why This Approach is Novel</h2>

            <div class="novelty-box">
                <h3>ğŸ¯ Comparison with Conventional Methods</h3>
                <table class="param-table">
                    <tr><th>Conventional Approach</th><th>This Simulator</th></tr>
                    <tr><td>IRF = Gaussian (black box)</td><td>Decomposed geometric factors with parametrization</td></tr>
                    <tr><td>Measure only results (FWHM)</td><td>Control individual causes (Îº, Î¸, Î±, Ïƒ, etc.)</td></tr>
                    <tr><td>Vendor-dependent corrections</td><td>Build your own Forward/Inverse model</td></tr>
                    <tr><td>1D convolution only</td><td>2D spatial integration + coordinate transform</td></tr>
                </table>
            </div>

            <div class="card">
                <p>XPS instrument manufacturers (Scienta Omicron, SPECS, etc.) implement geometric corrections, but the details are proprietary. This simulator <strong>decomposes and parametrizes</strong> these effects, making the "internals" of the instrumental function understandable and controllable.</p>
            </div>

            <!-- Section 2 -->
            <h2 id="en-flow">2. Simulation Pipeline</h2>

            <div class="flowchart">
                <div class="flow-box">True Physics<br>\(f_{\text{FD}}(E, T)\)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-box">X-ray Source 2D Emission<br>\(I_{\text{source}}(E, y)\)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-box">Detector Distortion + Transform<br>\(\mathcal{D}_{\kappa,\theta}\)</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-box">Y-axis Integration + Resolution Convolution</div>
                <div class="flow-arrow">â†“</div>
                <div class="flow-box">Observed Spectrum<br>\(S_{\text{obs}}(E)\)</div>
            </div>

            <!-- Section 3 -->
            <h2 id="en-fermi">3. Fermi-Dirac Distribution</h2>

            <div class="equation-box">
                \[
                f_{\text{FD}}(E, T) = \frac{1}{1 + \exp\left(\frac{E - E_F}{k_B T}\right)}
                \]
            </div>

            <table class="param-table">
                <tr><th>Parameter</th><th>Description</th><th>Value</th></tr>
                <tr><td>\(k_B\)</td><td>Boltzmann constant</td><td>\(8.617333262 \times 10^{-5}\) eV/K</td></tr>
                <tr><td>\(T\)</td><td>Sample temperature</td><td>UI: Temperature (K)</td></tr>
                <tr><td>\(E_F\)</td><td>Fermi energy</td><td>Reference (0 eV)</td></tr>
            </table>

            <!-- Section 4 -->
            <h2 id="en-source">4. X-ray Source Modeling</h2>

            <h3>4.1 Skew-Normal Distribution</h3>

            <div class="equation-box">
                \[
                \phi_\gamma(x; \sigma, \gamma) = 2 \cdot \frac{1}{\sigma\sqrt{2\pi}} \exp\left(-\frac{x^2}{2\sigma^2}\right) \cdot \frac{1}{2}\left[1 + \text{erf}\left(\frac{\gamma x}{\sigma\sqrt{2}}\right)\right]
                \]
            </div>

            <h3>4.2 2D Elliptical Gaussian with Rotation</h3>

            <p><strong>Rotation Transform:</strong></p>
            <div class="equation-box">
                \[
                \begin{pmatrix} E' \\ y' \end{pmatrix} =
                \begin{pmatrix} \cos\theta_{\text{rot}} & -\sin\theta_{\text{rot}} \\ \sin\theta_{\text{rot}} & \cos\theta_{\text{rot}} \end{pmatrix}
                \begin{pmatrix} E \\ y \end{pmatrix}
                \]
            </div>

            <h3>4.3 2D Emission Image Generation</h3>

            <div class="equation-box">
                \[
                I_{\text{source}}(E, y) = f_{\text{FD}}(E - \alpha y, T) \cdot \phi_{\gamma_y}(y; \sigma_y, \gamma_y)
                \]
            </div>

            <table class="param-table">
                <tr><th>Parameter</th><th>Description</th><th>UI Label</th></tr>
                <tr><td>\(\sigma_x\)</td><td>Energy-direction spot size</td><td>Spot Size X (meV)</td></tr>
                <tr><td>\(\sigma_y\)</td><td>Spatial-direction spot size</td><td>Spot Size Y (mm)</td></tr>
                <tr><td>\(\gamma_x, \gamma_y\)</td><td>Asymmetry parameters</td><td>Spot Skew X/Y</td></tr>
                <tr><td>\(\theta_{\text{rot}}\)</td><td>Spot rotation angle</td><td>Spot Rotation (deg)</td></tr>
                <tr><td>\(\alpha\)</td><td>Energy gradient (dE/dy)</td><td>Energy Gradient</td></tr>
            </table>

            <!-- Section 5 -->
            <h2 id="en-detector">5. Detector Modeling</h2>

            <h3>5.1 Geometric Distortion</h3>

            <div class="equation-box">
                \[
                E_{\text{src}} = E \cos\theta_{\text{tilt}} + y \sin\theta_{\text{tilt}}
                \]
                \[
                E_{\text{curved}} = E_{\text{src}} - \kappa \left(\frac{y}{y_{\max}}\right)^2
                \]
            </div>

            <div class="note">
                <strong>Smile Distortion (Îº):</strong> Due to spherical aberration in hemispherical analyzers, iso-energy lines become curved. After Y-axis integration, this produces an asymmetric tail extending toward higher binding energy.
            </div>

            <h3>5.2 1D Projection and Resolution Convolution</h3>

            <div class="equation-box">
                \[
                S_{\text{obs}}(E) = \left[\int_{-\infty}^{\infty} I_{\text{distorted}}(E, y) \, dy\right] \ast G_{\text{res}}(E; \sigma_{\text{res}})
                \]
            </div>

            <table class="param-table">
                <tr><th>Parameter</th><th>Description</th><th>UI Label</th></tr>
                <tr><td>\(\kappa\)</td><td>Smile curvature coefficient</td><td>Smile Curvature</td></tr>
                <tr><td>\(\theta_{\text{tilt}}\)</td><td>Detector tilt angle</td><td>Detector Tilt (deg)</td></tr>
                <tr><td>\(\sigma_{\text{res}}\)</td><td>Intrinsic resolution</td><td>Intrinsic Res (meV)</td></tr>
            </table>

            <!-- Section 6 -->
            <h2 id="en-noise">6. Noise Model</h2>

            <div class="equation-box">
                \[
                S_{\text{final}}(E) = \frac{\text{Poisson}\left(S_{\text{clean}} \cdot \lambda\right)}{\lambda} + \mathcal{N}(0, \sigma_{\text{readout}})
                \]
            </div>

            <table class="param-table">
                <tr><th>Noise Type</th><th>Characteristics</th><th>UI Label</th></tr>
                <tr><td>Poisson noise</td><td>Signal-dependent (shot noise)</td><td>Poisson Noise Level</td></tr>
                <tr><td>Gaussian noise</td><td>Signal-independent (readout noise)</td><td>Gaussian Readout Noise</td></tr>
            </table>

            <!-- Section 7 -->
            <h2 id="en-unified">7. Unified Mathematical Expression</h2>

            <div class="equation-box unified">
                <h3 style="color: var(--secondary); margin-bottom: 1rem;">Complete Observed Spectrum</h3>
                \[
                \boxed{
                S_{\text{obs}}(E) = \left[ \int_{-\infty}^{\infty} f_{\text{FD}}\left(\mathcal{T}(E, y; \kappa, \theta) - \alpha y, T\right) \cdot \phi_{\gamma_y}(y; \sigma_y, \gamma_y) \, dy \right] \ast G_{\text{res}}(E; \sigma_{\text{res}}) + \eta(E)
                }
                \]
            </div>

            <p>Where the coordinate transform is:</p>
            <div class="equation-box">
                \[
                \mathcal{T}(E, y; \kappa, \theta) = \left(E \cos\theta + y \sin\theta\right) - \kappa \left(\frac{y}{y_{\max}}\right)^2
                \]
            </div>

            <h3>Operator Notation</h3>
            <div class="equation-box final">
                \[
                S_{\text{obs}} = \mathcal{P}_y \left[ \mathcal{D}_{\kappa,\theta} \left[ \mathcal{S}_\alpha \left[ f_{\text{FD}} \right] \cdot W_y \right] \right] \ast G_{\text{res}} + \eta
                \]
            </div>

            <!-- Section 8 -->
            <h2 id="en-verification">8. Implementation Verification</h2>

            <div class="verification">
                <h3 style="margin-top: 0;">âœ“ Verified Items</h3>
                <div class="verification-item"><span class="check">âœ“</span> Boltzmann constant: CODATA 2018 compliant</div>
                <div class="verification-item"><span class="check">âœ“</span> Fermi-Dirac formula: Standard form</div>
                <div class="verification-item"><span class="check">âœ“</span> Skew-normal distribution: Correct definition with factor of 2</div>
                <div class="verification-item"><span class="check">âœ“</span> Rotation matrix: Counterclockwise positive (standard)</div>
                <div class="verification-item"><span class="check">âœ“</span> Smile distortion: yÂ² dependence (first-order spherical aberration)</div>
                <div class="verification-item"><span class="warn">âš </span> 2D skew-Gaussian: Product of 1D approximation (sufficient for practical use)</div>
            </div>

            <div class="note info">
                <strong>Literature Consistency:</strong> While literature treating the IRF as a Voigt function (Gaussian Ã— Lorentzian) exists, no published work parametrizing individual geometric factors was found. Instrument manufacturers implement corrections, but details remain proprietary.
            </div>

            <!-- Section 9 -->
            <h2 id="en-references">9. References</h2>

            <div class="card">
                <ul style="list-style: disc; padding-left: 1.5rem;">
                    <li>Jain, V. et al., <em>Applied Surface Science</em> 447, 548-553 (2018) - Voigt functions in XPS</li>
                    <li>Hemispherical Analyzer - <a href="https://en.wikipedia.org/wiki/Hemispherical_electron_energy_analyzer" target="_blank">Wikipedia</a></li>
                    <li>Scienta Omicron - <a href="https://scientaomicron.com/en/Instruments/Electron-Analysers" target="_blank">Electron Analysers</a></li>
                    <li>SPECS Group - <a href="https://www.specs-group.com/specs/products/" target="_blank">Products</a></li>
                </ul>
            </div>

        </div>

        <!-- Footer -->
        <footer>
            <p><strong>XPS IRF Simulator & Resolution Explorer</strong></p>
            <p>Author: Satoshi Toyoda | <a href="https://github.com/stoyoda0012-cyber/XPSTwin_streamlit" target="_blank">GitHub Repository</a></p>
            <p>App: <a href="https://xpstwinapp-fu3hrc35prlzqzncvmfaho.streamlit.app" target="_blank">https://xpstwinapp-fu3hrc35prlzqzncvmfaho.streamlit.app</a></p>
        </footer>
    </div>

    <script>
        function setLang(lang) {
            document.querySelectorAll('.ja-content, .en-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.lang-toggle button').forEach(el => el.classList.remove('active'));

            document.querySelector('.' + lang + '-content').classList.add('active');
            document.getElementById('btn-' + lang).classList.add('active');

            // Update HTML lang attribute
            document.documentElement.lang = lang === 'ja' ? 'ja' : 'en';
        }
    </script>
</body>
</html>
